<html>
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      async function drawChart() {
        const url = 'https://api.thingspeak.com/channels/3079296/feeds.json?api_key=062OKCYPCLU0FYNT';
    
        try {
            const response = await fetch(url);
            const json = await response.json();
            const feeds = json.feeds;

            const dataArray = [['Time', 'Temperature']];
            feeds.forEach(feed => {
                const time = new Date(feed.created_at);
                const temperature = parseFloat(feed.field1);
                if (!isNaN(temperature)) {
                    dataArray.push([time, temperature]);
                }
            });

        const data = google.visualization.arrayToDataTable(dataArray);

        const options = {
            title: 'Temperature Data',
            curveType: 'function',
            legend: { position: 'bottom' },
            hAxis: { title: 'Time' },
            vAxis: { title: 'Temperature (Â°C)' }
        };

        const chart = new google.visualization.LineChart(
            document.getElementById('curve_chart')
        );
        chart.draw(data, options);
      } catch (err) {
            console.error('Error fetching ThingSpeak data:', err);
            document.getElementById('curve_chart').innerText = 'Failed to load data';
        }
    }
    </script>
  </head>
  <body>
    <h1>Temperature Data from Thingspeak as Google Chart</h1>
    <div id="curve_chart" style="width: 900px; height: 500px"></div>
  </body>
</html>